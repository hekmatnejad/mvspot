#!/bin/sh
# -*- coding: utf-8 -*-
# Copyright (C) 2013 Laboratoire de Recherche et DÃ©veloppement
# de l'Epita (LRDE).
#
# This file is part of Spot, a model checking library.
#
# Spot is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# Spot is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
# or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public
# License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

. ./defs
set -e

ltl2tgba=ltl2tgba
ltlcross=ltlcross

# The formulas below have been removed from the list to reduce the time
# required to complete the test. In the future, we would like to respond
# quickly to them.
#
# GF(a <-> XXXb)
# X((a M F((!c & !b) | (c & b))) W (G!c U b))
# (Fa W b) R (Fc | !a)
# G((G!a & ((!b & X!c) | (b & Xc))) | (Fa & ((!b & Xc) | (b & X!c))))
# X(a R ((!b & F!c) M X!a))
# X(Gc | XG((b & Ga) | (!b & F!a)))
# (a U X!a) | XG(!b & XFc)
# XXG(Fa U Xb)
#
# Those ones were removed because they were too long in the "expected" file.
# We can not exceed 80 characters!
#
# p U (q & X(r & F(s & XF(u & XF(v & XFw)))))
# (p U q U r) || (q U r U p) || (r U p U q)

cat >formulas <<'EOF'
XXa
GF(a -> XXXb)
F(p & XF(q & XF(r & XFs)))
F(q & X(p U r))
F(p & X(q & XFr))
p U (q & X(r U s))
G(a -> Fb) & G(c -> Fd)
GFa & GFb
GFa | GFb | GFc
GFa
a U b U c U d
G(a -> Fb) & Gc
(Ga -> Fb) & (G!a -> F!b)
G(a -> Fb) & G(b -> Fc)
G(a -> Fb) & G(!a -> F!b)
GFp && GFq && GF r && GF u
G(p -> q U r)
GF(a <-> XXb)
G!c & G(a -> Fb) & G(b -> Fc)
G(a -> XXXb)
G(a -> Fb)
G(a U b U !a U !b)
X(((a & b) R (!a U !c)) R b)
(!a M !b) W F!c
(b & Fa & GFc) R a
(a R (b W a)) W G(!a M (c | b))
X(G(!a M !b) | G(a | G!a))
Fa W Gb
Ga | GFb
a M G(F!b | X!a)
G!a R XFb
XF(!a | GFb)
G(F!a U !a) U Xa
(a | G(a M !b)) W Fc
Fa W Xb
XG!a R Fb
GFc | (a & Fb)
X(a R (Fb R F!b))
G(Xa M Fa)
X(Gb | GFa)
Ga R Fb
G(a U (b | X((!c & !a) | (a & c))))
XG((G!a & F!b) | (Fa & (a | Gb)))
X(G!a | GFa)
G(G!a | F!c | G!b)
G(a | Fa)
EOF

# The following tests are named from 1 to 11 in order to reduce the length of
# each line. If a test fails during the diff, it is easily identifiable.
$ltlcross -F formulas \
  --timeout=60 \
  "{1} $ltl2tgba --det --lbtt %f >%T" \
  "{2} $ltl2tgba --det --lbtt -x tba-det %f >%T" \
  "{3} $ltl2tgba --det --lbtt -x sat-acc=1  %f >%T" \
  "{4} $ltl2tgba --det --lbtt -x sat-acc=3 %f >%T" \
  "{5} $ltl2tgba --det --lbtt -x sat-states=3 %f >%T" \
  "{6} $ltl2tgba --det --lbtt -x sat-minimize %f >%T" \
  "{7} $ltl2tgba --det --lbtt -x sat-minimize=2 %f >%T" \
  "{8} $ltl2tgba --det --lbtt -x sat-minimize=3 %f >%T" \
  "{9} $ltl2tgba --det --lbtt -x 'sat-minimize=3, incr2=1' %f >%T" \
  "{10} $ltl2tgba --det --lbtt -x 'sat-minimize=3, incr2=2' %f >%T" \
  "{11} $ltl2tgba --det --lbtt -x 'sat-minimize=3, incr2=5' %f >%T" \
  "{12} $ltl2tgba --det --lbtt -x 'sat-minimize=3, assume=1' %f >%T" \
  "{13} $ltl2tgba --det --lbtt -x 'sat-minimize=3, assume=2' %f >%T" \
  "{14} $ltl2tgba --det --lbtt -x 'sat-minimize=3, assume=5' %f >%T" \
  --csv=det.csv

grep -v ',\"5\",' det.csv | cut -d ',' -f '1,2,6' > extracted
